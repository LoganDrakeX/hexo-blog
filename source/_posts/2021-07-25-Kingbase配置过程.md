---
title: "Kingbase配置过程"
date: 2021-7-25
categories: 配置记录
tags:
 - 数据库
 - 配置
---

### 标准开头

记录一下Linux系统上Kingbase配置过程，纯命令方式
<!--more-->

### 第一步：安装Kingbase

1. 创建非root用户

   ```sh
   useradd sa
   sudo passwd sa
   ```

2. 将kingbase安装包ISO文件挂载到/home/kingbase目录下

   ```
   mount -o loop /home/Kingbase.iso /home/kingbase
   ```

3. 创建目录/opt/Kingbase/ES/V8

   ```sh
   mkdir -p /opt/Kingbase/ES/V8
   ```

4. 将安装包权限赋予sa用户

   ```sh
   chown -R sa:sa /home/kingbase
   ```

5. 将安装目录权限赋予sa用户

   ```sh
   chown -R sa:sa /opt/Kingbase/ES/V8
   ```

6. 安装,选择完全安装，选择授权文件

   ```sh
   sh setup.sh -i console
   ```

7. 将KingbaseES服务注册为系统服务

   ```sh
   sudo /opt/Kingbase/ES/V8/Scripts/root.sh
   ```

8. 启动数据库，切换目录/opt/Kingbase/ES/V8/Server/bin

   ```
   ./kingbase -D /opt/Kingbase/ES/V8/data -o
   ```

### 第二步：Kingbase数据库备份与恢复

1. 切换到/opt/Kingbase/ES/V8/ManagerTools/tools/bin目录，运行备份命令

   ```sh
   sys_dump -h 数据库服务器ip -p 数据库端口 -U 用户名 -W 密码 -f 备份文件存储路径 数据库名称
   sys_dump -h localhost -p 54321 -U sa -W 123456 -O -f /opt/kingbaseBackup/Archive_331000.dmp Archive_331000
   ```

2. 数据库初始化，切换目录/opt/Kingbase/ES/V8/Server/bin

   ```
   ./initdb -USYSTEM -W123456 --case-insensitive -D / opt/Kingbase/ES/v8/ data
   ```
   
3. 创建数据库GLK

   ```sh
   ./ksql -Usa -W123456 -p54321 TEST
   create database GLK;
   select datname from sys_database;
   ```

4. 切换到/opt/Kingbase/ES/V8/Server/bin目录，运行恢复命令

   ```sh
   ./ksql -h localhost -p54321 -Usa -W123456 -d GLK -f /opt/kingbaseBackup/GLK.dmp
   ```


### 遇到的问题

1. 在第一步6安装过程中设置数据库密码时卡死，终止进程后，直接执行第二步2即可

2. 在第二步2中数据库初始化加“--case-insensitive”选项是大小写不敏感，不加默认大小写敏感

   - 大小写敏感查看：

     ```
     cd /opt/Kingbase/ES/V8/Server/bin
     ./ksql -Usa -W123456 -p54321 TEST
     SHOW case_sensitive;
     ```

     on表示敏感，off表示不敏感

   - 大小写敏感：
     - 没有使用界定标识符（双引号）引起来的表名、列名，会默认转为大写
     - 使用界定标识符引起来的表名、列名，将以引起来的大小写进行存储，以及后续的查询匹配
   - 大小写不敏感：
     - 在创建表时，没有使用界定标识符（双引号）引起来的表名、列名，默认以当前输入的大小写进行存储，查询时也以全小写进行匹配
     - 在查询时，没有使用界定标识符（双引号）引起来的表名、列名，默认都转为小写进行匹配
     - 使用界定标识符引起来的表名、列名，将以引起来的大小写进行存储，以及后续的查询匹配